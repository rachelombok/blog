<!DOCTYPE html>
<html lang='en-us'>
<head>
    <meta charset="utf-8">
    <title>New Blog and Things I learned Building It | rachel&#39;s blog</title>
    <meta name="description" content="Hello, world!
After more than four years, I finally have my programming blog again üéâüéâüéâ. It&rsquo;s been bugging for quite some time.
Having a blog will be a good exercise to improve my writing skill. ‚Ä¶">
    <meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:title" content="New Blog and Things I learned Building It" />
<meta property="og:description" content="Hello, world!
After more than four years, I finally have my programming blog again üéâüéâüéâ. It&rsquo;s been bugging for quite some time.
Having a blog will be a good exercise to improve my writing skill. It&rsquo;s also a great way for documenting my learning journey and share back the knowledge to the vast programming community.
Table of Contents  The Tech Stacks New Things I Learned  Collapsible Sidebar with Pure CSS Nginx Header Is Overridden on a More Specific Block IP Tables Persistence Service is not Working on Ubuntu Xenial Generating Tag Archive Page in Jekyll Code Highlighting for PHP Won&rsquo;t Work Without Opening Tag Line Numbers for Code Snippets with GFM Syntax   Final Thoughts   The Tech Stacks I use Jekyll to generate this static blog." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/code/new-blog/" /><meta property="og:image" content="47"/><meta property="article:section" content="code" />
<meta property="article:published_time" content="2017-10-09T17:06:00&#43;02:00" />
<meta property="article:modified_time" content="2017-10-09T17:06:00&#43;02:00" /><meta property="og:site_name" content="Software Engineering" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="47"/>

<meta name="twitter:title" content="New Blog and Things I learned Building It"/>
<meta name="twitter:description" content="Hello, world!
After more than four years, I finally have my programming blog again üéâüéâüéâ. It&rsquo;s been bugging for quite some time.
Having a blog will be a good exercise to improve my writing skill. It&rsquo;s also a great way for documenting my learning journey and share back the knowledge to the vast programming community.
Table of Contents  The Tech Stacks New Things I Learned  Collapsible Sidebar with Pure CSS Nginx Header Is Overridden on a More Specific Block IP Tables Persistence Service is not Working on Ubuntu Xenial Generating Tag Archive Page in Jekyll Code Highlighting for PHP Won&rsquo;t Work Without Opening Tag Line Numbers for Code Snippets with GFM Syntax   Final Thoughts   The Tech Stacks I use Jekyll to generate this static blog."/>
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
    <link rel="stylesheet" href="/styles.min.9606769ff64b7bcb06eaeff008d91ef001a5fffd74383d9b698531628b2f525e.css">
    <link rel=icon href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üç£</text></svg>'></head>
<body>
<header>
    <a href="/" class='blog-title'>
       
        <h1>blog.</h1>
    </a>
    <nav>
        <a href="/categories/">Categories</a>
        
        <a href="/about/">About</a>
    </nav>
</header>
<main>
<article>
    <h1 class='article-title'>New Blog and Things I learned Building It</h1><time datetime='2017-10-09T17:06:00&#43;02:00'>2017-10-09</time><p>Hello, world!</p>
<p>After more than four years, I finally have my programming blog again üéâüéâüéâ. It&rsquo;s been bugging for quite some time.</p>
<p>Having a blog will be a good exercise to improve my writing skill. It&rsquo;s also a great way for documenting my learning journey and share back the knowledge to the vast programming community.</p>
<h2>Table of Contents</h2>
<nav id="TableOfContents">
  <ul>
    <li><a href="#the-tech-stacks">The Tech Stacks</a></li>
    <li><a href="#new-things-i-learned">New Things I Learned</a>
      <ul>
        <li><a href="#collapsible-sidebar-with-pure-css">Collapsible Sidebar with Pure CSS</a></li>
        <li><a href="#nginx-header-is-overridden-on-a-more-specific-block">Nginx Header Is Overridden on a More Specific Block</a></li>
        <li><a href="#ip-tables-persistence-service-is-not-working-on-ubuntu-xenial">IP Tables Persistence Service is not Working on Ubuntu Xenial</a></li>
        <li><a href="#generating-tag-archive-page-in-jekyll">Generating Tag Archive Page in Jekyll</a></li>
        <li><a href="#code-highlighting-for-php-wont-work-without-opening-tag">Code Highlighting for PHP Won&rsquo;t Work Without Opening Tag</a></li>
        <li><a href="#line-numbers-for-code-snippets-with-gfm-syntax">Line Numbers for Code Snippets with GFM Syntax</a></li>
      </ul>
    </li>
    <li><a href="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav>

<h2 id="the-tech-stacks">The Tech Stacks</h2>
<p>I use <a href="https://jekyllrb.com">Jekyll</a> to generate this static blog. I&rsquo;ve designed it to be minimal and uncluttered. Making an emphasize on the content. I also try keeping the CSS and the JS file sizes as lean as possible. There&rsquo;s even no third party library, except for the slim down version of <a href="https://necolas.github.io/normalize.css">Normalize.css</a> from <a href="https://github.com/twbs/bootstrap/blob/v4-dev/scss/_reboot.scss">Bootstrap</a> framework.</p>
<p>I host this blog on a cheap $10 VPS provided by <a href="https://m.do.co/c/4504f3411d63">DigitalOcean</a> (referal link), serve them over Nginx (check my Nginx configuration <a href="https://github.com/risan/nginx-config">here</a>). For SSL certificate, I get it for free from <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a>. I&rsquo;ve also enabled the HTTP/2 protocol on Nginx to improve performance.</p>
<p>Although there&rsquo;s a Sprockets based <a href="https://jekyll.github.io/jekyll-assets">Jekyll plugin</a> for managing the assets, I prefer to use <a href="https://gulpjs.com">Gulp</a> for building them. It&rsquo;s much more flexible and configurable. More importantly, I&rsquo;m much more comfortable working with Javascript. I use the <a href="https://github.com/imagemin/imagemin"><code>image-min</code></a> package for automatically resizing and compressing the images.</p>
<h2 id="new-things-i-learned">New Things I Learned</h2>
<p>There are also several new things I&rsquo;ve learned when building up this new blog:</p>
<h3 id="collapsible-sidebar-with-pure-css">Collapsible Sidebar with Pure CSS</h3>
<p>I want to have a collapsible sidebar for displaying a list of main navigation links on this blog. I know that I can easily achieve this with our old friend jQuery. However, I want my website to have as less JavaScript as it can. I also want this drawer style menu to be fully functioning even without a JavaScript.</p>
<p>Then I came across to <a href="https://github.com/poole/lanyon">Lanyon</a> theme. It has a collapsible sidebar and surprisingly without any JavaScript file! It turns out it just using a checkbox and the CSS sibling selector. It&rsquo;s a clever trick. I believe I‚Äôve come across this CSS trick years ago somewhere, but never actually implement it on my own.</p>
<p>Suppose you have the following HTML structure for your collapsible sidebar:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">nav</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;navbar&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;checkbox&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;navbar-checkbox&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">ul</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;navbar-nav&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">li</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;#&#34;</span>&gt;Menu 1&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">li</span>&gt;
    &lt;<span style="color:#ff79c6">li</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;#&#34;</span>&gt;Menu 2&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">li</span>&gt;
    &lt;<span style="color:#ff79c6">li</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;#&#34;</span>&gt;Menu 3&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">li</span>&gt;
  &lt;/<span style="color:#ff79c6">ul</span>&gt;
&lt;/<span style="color:#ff79c6">nav</span>&gt;
</code></pre></div><p>You can target the <code>.navbar-checkbox</code> selected state with the <code>:checked</code> pseudo-class selector like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scss" data-lang="scss"><span style="color:#50fa7b">.navbar-checkbox</span>:checked {
    <span style="color:#6272a4">//
</span><span style="color:#6272a4"></span>}
</code></pre></div><p>You can combine this selector with <code>~</code> (the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/General_sibling_selectors">general sibling combinator</a>) for targeting the followed <code>ul</code> element:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scss" data-lang="scss"><span style="color:#50fa7b">.navbar-checkbox</span>:checked <span style="color:#ff79c6">~</span> <span style="color:#50fa7b">.navbar-nav</span> {
    <span style="color:#6272a4">//
</span><span style="color:#6272a4"></span>}
</code></pre></div><p>With this trick, you can easily manipulate the followed <code>ul</code> visibility based on the checkbox state.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.<span style="color:#50fa7b">navbar-nav</span> {
  <span style="color:#ff79c6">display</span>: <span style="color:#ff79c6">none</span>;
}

.<span style="color:#50fa7b">navbar-checkbox</span>:checked <span style="color:#ff79c6">~</span> .<span style="color:#50fa7b">navbar-nav</span> {
  <span style="color:#ff79c6">display</span>: <span style="color:#ff79c6">block</span>;
}
</code></pre></div><p>Well, actually for this example you can just use the <code>+</code> combinator (<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Adjacent_sibling_selectors">adjacent sibling combinator</a>). The only difference is that the <code>+</code> will only be targeting the immediate sibling.</p>
<h3 id="nginx-header-is-overridden-on-a-more-specific-block">Nginx Header Is Overridden on a More Specific Block</h3>
<p>I spotted this Nginx behavior when re-visiting my configuration boilerplate <a href="https://github.com/risan/nginx-config">here</a>. When you set a header using the <code>add_header</code> directive, it will replace any previously set header on a less specific location block.</p>
<p>Suppose you set the <code>Access-Control-Allow-Origin</code> header for all the files under the root location:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#ff79c6">server</span> {
    <span style="color:#ff79c6">location</span> <span style="color:#f1fa8c">/</span> {
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Access-Control-Allow-Origin</span> <span style="color:#f1fa8c">&#34;*&#34;</span>;
    }
}
</code></pre></div><p>If you request for an index file or any other files under the root path, you&rsquo;ll surely find this header on the response.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Get the response&#39;s headers of test.json</span>
curl -I https://example.com/test.json

<span style="color:#6272a4"># The output</span>
content-type: application/json; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>utf-8
access-control-allow-origin: *
</code></pre></div><p>But if you later set another header on a more specific location block, the headers inherited from a less specific scope will be overridden. For example, let&rsquo;s say you set a <code>Cache-Control</code> header for all of the JSON files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#ff79c6">server</span> {
    <span style="color:#ff79c6">location</span> <span style="color:#f1fa8c">/</span> {
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Access-Control-Allow-Origin</span> <span style="color:#f1fa8c">&#34;*&#34;</span>;
    }

    <span style="color:#ff79c6">location</span> ~<span style="color:#f1fa8c">*</span> <span style="color:#f1fa8c">\.json</span> {
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Cache-Control</span> <span style="color:#f1fa8c">&#34;public,</span> <span style="color:#f1fa8c">max-age=600&#34;</span>;
    }
}
</code></pre></div><p>Any headers that previously set from the <code>/</code> location will be replaced by the <code>Cache-Control</code> header.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -I https://example.com/test.json

<span style="color:#6272a4"># The access-control-allow-origin header is replaced</span>
content-type: application/json; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>utf-8
cache-control: public, max-age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">600</span>
</code></pre></div><p>But if you request for any other non-JSON files, the <code>Access-Control-Allow-Origin</code> header will still be available.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Get the response&#39;s headers of the index file</span>
curl -I https://example.com

<span style="color:#6272a4"># The output</span>
content-type: application/json; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>utf-8
access-control-allow-origin: *
</code></pre></div><p>Note that this is the intended behavior, you can check this on the Nginx documentation <a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header">here</a>.</p>
<blockquote>
<p>There could be several <code>add_header</code> directives. These directives are inherited from the previous level if and only if there are no <code>add_header</code> directives defined on the current level.</p>
</blockquote>
<p>To work around this behavior, you can simply redeclare the previously set headers on a more specific location block like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#ff79c6">server</span> {
    <span style="color:#ff79c6">location</span> <span style="color:#f1fa8c">/</span> {
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Access-Control-Allow-Origin</span> <span style="color:#f1fa8c">&#34;*&#34;</span>;
    }

    <span style="color:#ff79c6">location</span> ~<span style="color:#f1fa8c">*</span> <span style="color:#f1fa8c">\.json</span> {
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Access-Control-Allow-Origin</span> <span style="color:#f1fa8c">&#34;*&#34;</span>;
        <span style="color:#ff79c6">add_header</span> <span style="color:#f1fa8c">Cache-Control</span> <span style="color:#f1fa8c">&#34;public,</span> <span style="color:#f1fa8c">max-age=600&#34;</span>;
    }
}
</code></pre></div><p>Or you can install the <a href="https://github.com/openresty/headers-more-nginx-module">headers-more</a> module and use the provided <a href="https://github.com/openresty/headers-more-nginx-module#more_set_headers"><code>more_set_headers</code></a> directive.</p>
<h3 id="ip-tables-persistence-service-is-not-working-on-ubuntu-xenial">IP Tables Persistence Service is not Working on Ubuntu Xenial</h3>
<p>I&rsquo;m using the latest LTS version of Ubuntu to host this website: 16.04 Xenial Xerus. When I tried to start the <code>iptables-persistent</code> service to persist my IP tables configuration between reboot, I got an error:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Try to start the service</span>
sudo service iptables-persistent start

<span style="color:#6272a4"># Got an error instead</span>
Failed to start iptables-persistent.service: Unit iptables-persistent.service not found.
</code></pre></div><p>It looks like the <code>iptables-persistent</code> package no longer provides the <code>init.d</code> service since Debian 8 Jessie, thus affecting its derivatives including Ubuntu Xenial.</p>
<p>The persistence functionality now has been split into two packages: <code>netfilter-persistent</code> and <code>iptables-persistent</code>. The <code>iptables-persistent</code> is now acting as a plugin to <code>netfilter-persistent</code> and no longer provide the <code>init.d</code> service. You can install these two packages like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get install -y iptables-persistent netfilter-persistent
</code></pre></div><p>Now you can instead use the <code>netfilter-persistent</code> service to persist your IP tables configuration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo service netfilter-persistent start
</code></pre></div><h3 id="generating-tag-archive-page-in-jekyll">Generating Tag Archive Page in Jekyll</h3>
<p>Although there‚Äôs already a <a href="https://github.com/jekyll/jekyll-archives">plugin</a> for generating the archive pages for tags or categories, it‚Äôs actually pretty simple to generate it yourself. You can take a look at the <a href="https://jekyllrb.com/docs/plugins/#generators">Generators Plugin</a> section on Jekyll documentation.</p>
<p>All you have to do is to create a custom generator class that extends the <a href="https://github.com/jekyll/jekyll/blob/master/lib/jekyll/generator.rb"><code>Jekyll::Generator</code></a>. Within this class, you have to define the <code>generate</code> method that receives an instance of <a href="https://github.com/jekyll/jekyll/blob/master/lib/jekyll/site.rb"><code>Jekyll::site</code></a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#6272a4"># ./_plugins/tag_page_generator.rb</span>
<span style="color:#ff79c6">module</span> Jekyll
  <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TagPageGenerator</span> <span style="color:#ff79c6">&lt;</span> Generator
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">generate</span>(site)
      <span style="color:#6272a4"># Your archive page creation logic will go here</span>
    <span style="color:#ff79c6">end</span>
  <span style="color:#ff79c6">end</span>
<span style="color:#ff79c6">end</span>
</code></pre></div><p>You can get access to all of your tags and loop through it like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">generate</span>(site)
  site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">.</span>each_key <span style="color:#ff79c6">do</span> <span style="color:#ff79c6">|</span>tag<span style="color:#ff79c6">|</span>
    <span style="color:#8be9fd;font-style:italic">puts</span> tag <span style="color:#6272a4"># Will replace this with tag archive page creation</span>
  <span style="color:#ff79c6">end</span>
<span style="color:#ff79c6">end</span>
</code></pre></div><p>You need to generate an archive page for each tag. On each iteration, you need to create an instance of this archive tag page and push it to the <code>site.pages</code> attribute.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">.</span>each_key <span style="color:#ff79c6">do</span> <span style="color:#ff79c6">|</span>tag<span style="color:#ff79c6">|</span>
    site<span style="color:#ff79c6">.</span>pages <span style="color:#ff79c6">&lt;&lt;</span> your_tag_archive_page_instance
<span style="color:#ff79c6">end</span>
</code></pre></div><p>Now you need to define a custom <code>TagArchivePage</code> class that represents the archive tag page. This class needs to extend from the <a href="https://github.com/jekyll/jekyll/blob/master/lib/jekyll/page.rb"><code>Page</code></a> class.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#6272a4"># ./_plugins/tag_page_generator.rb</span>
<span style="color:#ff79c6">module</span> Jekyll
  <span style="color:#6272a4"># TagPageGenerator class here...</span>

  <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TagArchivePage</span> <span style="color:#ff79c6">&lt;</span> Page
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">initialize</span>(site, base, tag)
      <span style="color:#8be9fd;font-style:italic">@site</span> <span style="color:#ff79c6">=</span> site
      <span style="color:#8be9fd;font-style:italic">@base</span> <span style="color:#ff79c6">=</span> base <span style="color:#6272a4"># The site build directory</span>
      <span style="color:#8be9fd;font-style:italic">@dir</span> <span style="color:#ff79c6">=</span> File<span style="color:#ff79c6">.</span>join(<span style="color:#f1fa8c">&#39;tags&#39;</span>, tag) <span style="color:#6272a4"># Tag archive pages directory</span>
      <span style="color:#8be9fd;font-style:italic">@name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;index.html&#39;</span> <span style="color:#6272a4"># Tag archive file name</span>

      process(<span style="color:#8be9fd;font-style:italic">@name</span>)
      <span style="color:#6272a4"># The tag archive layout file.</span>
      read_yaml(File<span style="color:#ff79c6">.</span>join(base, <span style="color:#f1fa8c">&#39;_layouts&#39;</span>), <span style="color:#f1fa8c">&#39;tag_archive.html&#39;</span>)

      <span style="color:#6272a4"># Set page variables.</span>
      data<span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;title&#39;</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">#{</span>tag<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> Archive&#34;</span>
      data<span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;posts&#39;</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">[</span>tag<span style="color:#ff79c6">]</span>
    <span style="color:#ff79c6">end</span>
  <span style="color:#ff79c6">end</span>
<span style="color:#ff79c6">end</span>
</code></pre></div><p>With the configuration above, your tag archive page will be generated at <code>/tags/tag-name/index.html</code>. Back to your <code>TagPageGenerator</code> class, you can now create the <code>TagArchivePage</code> instance for each tag and push them to <code>site.pages</code> attribute.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TagPageGenerator</span> <span style="color:#ff79c6">&lt;</span> Generator
  <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">generate</span>(site)
    site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">.</span>each_key <span style="color:#ff79c6">do</span> <span style="color:#ff79c6">|</span>tag<span style="color:#ff79c6">|</span>
      site<span style="color:#ff79c6">.</span>pages <span style="color:#ff79c6">&lt;&lt;</span> TagArchivePage<span style="color:#ff79c6">.</span>new(site, site<span style="color:#ff79c6">.</span>source, tag)
    <span style="color:#ff79c6">end</span>
  <span style="color:#ff79c6">end</span>
<span style="color:#ff79c6">end</span>
</code></pre></div><p>You also need to define a layout file for this tag archive page in: <code>_layouts/tag_archive.html</code>. You can simply loop through the <code>posts</code> variable, this page variable contains all of the posts under the given tag.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#6272a4">&lt;!-- ./_layouts/tag_archive.html --&gt;</span>
&lt;<span style="color:#ff79c6">main</span>&gt;
    &lt;<span style="color:#ff79c6">h1</span>&gt;{% raw %}{{ page.title }}{% endraw %}&lt;/<span style="color:#ff79c6">h1</span>&gt;
    &lt;<span style="color:#ff79c6">ul</span>&gt;
        {% raw %}{% for post in page.posts %}{% endraw %}
            &lt;<span style="color:#ff79c6">li</span>&gt;
                &lt;<span style="color:#ff79c6">h2</span>&gt;
                    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;{% raw %}{{ post.url }}{% endraw %}&#34;</span>&gt;{% raw %}{{ post.title }}{% endraw %}&lt;/<span style="color:#ff79c6">a</span>&gt;
                &lt;/<span style="color:#ff79c6">h2</span>&gt;
            &lt;/<span style="color:#ff79c6">li</span>&gt;
        {% raw %}{% endfor %}{% endraw %}
    &lt;/<span style="color:#ff79c6">ul</span>&gt;
&lt;/<span style="color:#ff79c6">main</span>&gt;
</code></pre></div><p>Now, you&rsquo;re all set. Your <code>tag_page_generator.rb</code> file should look like this now:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#ff79c6">module</span> Jekyll
  <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TagPageGenerator</span> <span style="color:#ff79c6">&lt;</span> Generator
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">generate</span>(site)
      site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">.</span>each_key <span style="color:#ff79c6">do</span> <span style="color:#ff79c6">|</span>tag<span style="color:#ff79c6">|</span>
        site<span style="color:#ff79c6">.</span>pages <span style="color:#ff79c6">&lt;&lt;</span> TagArchivePage<span style="color:#ff79c6">.</span>new(site, site<span style="color:#ff79c6">.</span>source, tag)
      <span style="color:#ff79c6">end</span>
    <span style="color:#ff79c6">end</span>
  <span style="color:#ff79c6">end</span>

  <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">TagArchivePage</span> <span style="color:#ff79c6">&lt;</span> Page
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">initialize</span>(site, base, tag)
      <span style="color:#8be9fd;font-style:italic">@site</span> <span style="color:#ff79c6">=</span> site
      <span style="color:#8be9fd;font-style:italic">@base</span> <span style="color:#ff79c6">=</span> base
      <span style="color:#8be9fd;font-style:italic">@dir</span> <span style="color:#ff79c6">=</span> File<span style="color:#ff79c6">.</span>join(<span style="color:#f1fa8c">&#39;tags&#39;</span>, tag)
      <span style="color:#8be9fd;font-style:italic">@name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;index.html&#39;</span>

      process(<span style="color:#8be9fd;font-style:italic">@name</span>)
      read_yaml(File<span style="color:#ff79c6">.</span>join(base, <span style="color:#f1fa8c">&#39;_layouts&#39;</span>), <span style="color:#f1fa8c">&#39;tag_archive.html&#39;</span>)

      data<span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;title&#39;</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">#{</span>tag<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> Archive&#34;</span>
      data<span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;posts&#39;</span><span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> site<span style="color:#ff79c6">.</span>tags<span style="color:#ff79c6">[</span>tag<span style="color:#ff79c6">]</span>
    <span style="color:#ff79c6">end</span>
  <span style="color:#ff79c6">end</span>
<span style="color:#ff79c6">end</span>
</code></pre></div><h3 id="code-highlighting-for-php-wont-work-without-opening-tag">Code Highlighting for PHP Won&rsquo;t Work Without Opening Tag</h3>
<p>I&rsquo;m using <a href="https://github.com/jneen/rouge">Rouge</a> for syntax highlighting. I&rsquo;ve just discovered that it won&rsquo;t work for PHP code without an opening tag (<code>&lt;?php</code>) like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#8be9fd;font-style:italic">$collection</span> <span style="color:#ff79c6">=</span> collect([<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>]);

<span style="color:#8be9fd;font-style:italic">$total</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$collection</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">reduce</span>(<span style="color:#ff79c6">function</span> (<span style="color:#8be9fd;font-style:italic">$carry</span>, <span style="color:#8be9fd;font-style:italic">$item</span>) {
    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">$carry</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">$item</span>;
});
</code></pre></div><p>To work around this, you can pass the <code>start_inline=1</code> option following the syntax language:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-markdown" data-lang="markdown">```php?start_inline=1
    $collection = collect([1, 2, 3]);

    $total = $collection-&gt;reduce(function ($carry, $item) {
        return $carry + $item;
    });
```
</code></pre></div><p>Now your PHP code should be highlighted properly like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#8be9fd;font-style:italic">$collection</span> <span style="color:#ff79c6">=</span> collect([<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">3</span>]);

<span style="color:#8be9fd;font-style:italic">$total</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$collection</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">reduce</span>(<span style="color:#ff79c6">function</span> (<span style="color:#8be9fd;font-style:italic">$carry</span>, <span style="color:#8be9fd;font-style:italic">$item</span>) {
    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">$carry</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">$item</span>;
});
</code></pre></div><h3 id="line-numbers-for-code-snippets-with-gfm-syntax">Line Numbers for Code Snippets with GFM Syntax</h3>
<p>As you may have already known, on Jekyll you can display the line numbers next to your code snippets by using the <code>{% raw %}{% highlight %}{% endraw %}</code> tag and passing the <code>linenos</code> option like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-markdown" data-lang="markdown">{% raw %}{% highlight javascript linenos %}{% endraw %}
    console.log(&#39;Hello, World!&#39;);
{% raw %}{% endhighlight %}{% endraw %}
</code></pre></div><p>If you&rsquo;re using the default combination of Kramdown converter and Rogue highlighter, this won&rsquo;t work if you use the GFM (<a href="https://help.github.com/articles/basic-writing-and-formatting-syntax">GitHub Flavored Markdown</a>) syntax‚Äîwith backtick for highlighting the code. To work around this, you can globally set the Rouge <code>line_numbers</code> option within the <code>_config.yml</code> file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#6272a4"># ./_config.yml</span>

<span style="color:#ff79c6">kramdown</span>:
  <span style="color:#ff79c6">syntax_highlighter</span>: rouge
  <span style="color:#ff79c6">syntax_highlighter_opts</span>:
    <span style="color:#ff79c6">span</span>:
      <span style="color:#6272a4"># You don&#39;t want to have line number on inline code.</span>
      <span style="color:#ff79c6">line_numbers</span>: <span style="color:#ff79c6">false</span>
    <span style="color:#ff79c6">block</span>:
      <span style="color:#ff79c6">line_numbers</span>: <span style="color:#ff79c6">true</span>
      <span style="color:#ff79c6">start_line</span>: <span style="color:#bd93f9">1</span>
</code></pre></div><p>The downside is, all of your code snippets will have line numbers. There&rsquo;s no way to toggle it off individually.</p>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>I hope by having this blog, I can refine my writing skills and be more efficient on communicating my ideas. I also hope that you&rsquo;ll find this blog useful. üôèüèªüôèüèªüôèüèª</p>
<footer>
        <ul>
            <li>
                <span>Categories:&nbsp;</span><a href="/categories/log/">log</a></li>
            <li>
                <span>Tags:&nbsp;</span><a href="/tags/css/">css</a>,&nbsp;<a href="/tags/nginx/">nginx</a>,&nbsp;<a href="/tags/jekyll/">jekyll</a></li><li><span>Next:&nbsp;</span><a href="/code/upgrade-ssh-key-to-ed25519/">Upgrade Your SSH Key to Ed25519</a></li><li><span>Previous:&nbsp;</span><a href="/code/tutorial-dasar-facebook-php-sdk/">Tutorial Dasar Facebook PHP SDK</a></li></ul>
    </footer></article>
</main>
<footer>
    <small>&copy; Rachel Ombok 2021</small>
    <nav>
        <small><a href="https://github.com/rachelombok">Github</a>
        <a href="https://twitter.com/therachelplan">Twitter</a>
        <a href="https://rachelombok.com/">Main</a></small>
    </nav>
</footer></body>
</html>